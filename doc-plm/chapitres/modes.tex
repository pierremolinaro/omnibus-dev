%!TEX encoding = UTF-8 Unicode
%!TEX root = ../doc-plm.tex





\chapterLabel{Modes d'exécution}{chapitreModesExecution}

Un \emph{mode d'exécution} est une annotation qui permet au compilateur de vérifier la cohérence des appels des routines, et qui n'ajoute aucun code supplémentaire à l'exécution.

En PLM, à toute routine est associé un ou plusieurs modes \emph{modes d'exécution}\index{Mode@Mode d'exécution}.

Syntaxiquement, un mode d'exécution est un nom précédé du caractère « \texttt{\`} » : par exemple, \plm+`boot+. Trois modes d'exécution sont prédéfinis \plm+`boot+, \plm+`init+ et \plm+`panic+ (voir \refSectionPage{modesPredefinis}). Souvent, une cible définit d'autres modes, tels que par exemple \plm+`isr+ pour les routines d'interruption, et \plm+`user+ pour des routines s'exécutant en mode utilisateur.

Les annotations de mode d'une routine sont inscrites dans l'en-tête de la routine, après son nom (voir la déclaration d'une procédure, \refSubsectionPage{declarationProcedure}). Par exemple :

\begin{PLM}
proc uneProcedure `user `init () {
}
\end{PLM}


\section{Des exemples}

Considérons le code suivant :
\begin{PLM}
proc uneRoutine `user () {
}

proc routineAppelante `user () {
  uneRoutine () // Appel valide
}
\end{PLM}

L'appel de \plm+uneRoutine+ est valide, car l'ensemble des modes de la routine appelée \plm+uneRoutine+ est \{\plm+`user+\} et est égal à l'ensemble des modes de la routine appelante \plm+routineAppelante+. Mais l'égalité des deux ensembles de mode n'est pas obligatoire ; par exemple :

\begin{PLM}
proc uneRoutine `user `isr () {
}

proc routineAppelante `user () {
  uneRoutine () // Appel valide
}
\end{PLM}


L'appel de \plm+uneRoutine+ est toujours valide, car l'ensemble des modes de la routine appelée \plm+uneRoutine+ est \{\plm+`user+, \plm+`isr+\} et contient l'ensemble des modes de la routine appelante \plm+routineAppelante+ qui est \{\plm+`user+\}. 

Par contre, l'appel suivant est incorrect :

\begin{PLM}
proc uneRoutine `isr () {
}

proc routineAppelante `user `isr () {
  uneRoutine () // Erreur : appel invalide
}
\end{PLM}

L'appel de \plm+uneRoutine+ est invalide, car l'ensemble des modes de la routine appelée \plm+uneRoutine+ est \{\plm+`isr+\} et ne contient pas l'ensemble des modes de la routine appelante \plm+routineAppelante+ qui est \{\plm+`isr+, \plm+`user+\}. En effet, la routine appelante \plm+routineAppelante+ peut elle-même être appelée à partir d'une routine dont le mode est \plm+`user+ : autoriser l'appel de \plm+uneRoutine+ aurait pour conséquence de pouvoir appeler de manière indirecte une routine dont le mode associé est \plm+`isr+ à partir d'une routine dont le mode est \plm+`user+.


\sectionLabel{Modes prédéfinis}{modesPredefinis}

Le compilateur prédéfinit trois modes d'exécution (\refTableauPage{ModeExecutionPredefinis}).





\begin{table}[t]
\centering
\begin{tabular}{lll}
  \textbf{Mode} & \textbf{Commentaire} & \textbf{Lien} \\
  \plm=`boot= & Routines exécutées au démarrage & \refSectionPage{bootRoutine} \\
  \plm=`init= & Routines d'initialisation & \refSectionPage{initRoutine} \\
  \plm=`panic= & Routines d'exception & \refSectionPage{routineException} \\
\end{tabular}
\caption{Modes d'exécution prédéfinis}
\labelTableau{ModeExecutionPredefinis}
\ligne
\end{table}
