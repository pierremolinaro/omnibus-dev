target "target-teensy-sequential-systick.plms"

//-----------------------------------------------------------------------------*

proc setup $user () {
}

//-----------------------------------------------------------------------------*
let cst : UInt32 = 2

var gClignotement $isr : UInt32 = cst

//-----------------------------------------------------------------------------*

proc userSystickHandler $isr () {
  gClignotement ++
  if gClignotement == 500 then
    ledOn (!LED_L0) ;
  elsif gClignotement == 1000 then
    gClignotement = 0
    ledOff (!LED_L0) ;
  end
}

//-----------------------------------------------------------------------------*

var gVar $user : Int8 = 12

//-----------------------------------------------------------------------------*

//exception setup 255 {
//  AIRCR = AIRCR::VECTKEY(0x5FA) | AIRCR::SYSRESETREQ
//}

proc loop $user () {
  waitMS (!100)
  ledOn (!LED_TEENSY)
  waitMS (!100)
  ledOff (!LED_TEENSY)
  gVar ++ // Engendre une exception
  goto (!line:0 !column: 0)
  printSpaces (!4)
  goto (!line:0 !column: 0)
  printSigned (!gVar)
}

//-----------------------------------------------------------------------------*
