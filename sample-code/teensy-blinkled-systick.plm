target "target-teensy-sequential-systick.plms"

//-----------------------------------------------------------------------------*

proc $user setup () {
  PORTC_PCR5 = (1 << 8)
  GPIOC_PDDR = GPIOC_PDDR | (1 << 5)
}

//-----------------------------------------------------------------------------*

proc $user ledOn () {
  GPIOC_PSOR = 1 << 5
}

//-----------------------------------------------------------------------------*

proc $user ledOff () {
  GPIOC_PCOR = 1 << 5
}

//-----------------------------------------------------------------------------*

var $user $isr gCompteur : UInt32 = 0

//-----------------------------------------------------------------------------*

proc $isr systickHandler () {
  gCompteur ++ 
}

//-----------------------------------------------------------------------------*

proc $user waitMS (? UInt32 inDuration) {
  let deadline = gCompteur + inDuration
  while gCompteur < deadline do
  end
}

//-----------------------------------------------------------------------------*

proc $user loop () {
  let duration : UInt32 = 500
  waitMS (!duration)
  ledOn ()
  waitMS (!duration)
  ledOff ()
}

//-----------------------------------------------------------------------------*
