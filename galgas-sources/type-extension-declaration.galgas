#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#  AST                                                                                                                  
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

list @extensionDeclarationListAST {
  @lstring mTypeName
  @functionDeclarationListAST mProcedureDeclarationListAST
  @structureFieldListAST mFieldList
  @serviceDeclarationListAST mServiceListAST
  @sectionDeclarationListAST mSectionListAST
  @primitiveDeclarationListAST mPrimitiveListAST
  @guardDeclarationListAST mGuardListAST
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#  SYNTAX                                                                                                               
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

syntax extension common_syntax {

  #·····················································································································

  rule <declaration> ?!@ast ioAST {
    $extension$
    $\$type$ ?let typeName
    ${$
    @functionDeclarationListAST procedureDeclarationListAST = {}
    @structureFieldListAST fieldList = {}
    @serviceDeclarationListAST serviceListAST = {}
    @sectionDeclarationListAST sectionListAST = {}
    @primitiveDeclarationListAST primitiveListAST = {}
    @guardDeclarationListAST guardListAST = {}
    repeat
    while
      @bool public
      select
        public = false
      or
        $public$
        public = true
      end
      $var$
      $identifier$ ?let fieldName
      $\$type$ ?let typeName
      $=$
      <expression> ?let initExpression
      fieldList += !fieldName !public !typeName !.expression{!initExpression:initExpression}
    while
      <procedure> !?procedureDeclarationListAST
    while
     <section> !?sectionListAST
    while
      <service> !?serviceListAST
    while
      <guard> !?guardListAST
    while
      <primitive> !?primitiveListAST
    while
      $;$
    end
    $}$
    ioAST.mExtensionDeclarationListAST +=
      !typeName
      !procedureDeclarationListAST
      !fieldList
      !serviceListAST
      !sectionListAST
      !primitiveListAST
      !guardListAST
  }

  #·····················································································································

}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

abstract method @abstractDeclaration addExtension
  ?!@extensionDeclarationListAST ioExtensionDeclarationListAST
  !@abstractDeclaration outNewDeclaration

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
