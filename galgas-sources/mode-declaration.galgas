#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#  AST                                                                                                                 *
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

class @modeDeclaration : @abstractDeclaration {
  @lstring mModeName
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

override getter @modeDeclaration location -> @location outLocation {
  outLocation = mModeName.location
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#  SYNTAX                                                                                                              *
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

syntax extension plm_target_specific_syntax {

  #·····················································································································

  rule <declaration> ?!@ast ioAST {
    $mode$
    $modeName$ ?let modeName
    ioAST.mDeclarationList += !@modeDeclaration.new {!modeName}
  }

  #·····················································································································

}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#  MODE NAMES                                                                                                          *
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func %once bootModeName -> @string outResult {
  outResult = "boot"
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func %once initModeName -> @string outResult {
  outResult = "init"
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func %once sectionModeName -> @string outResult {
  outResult = "section"
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func %once userModeName -> @string outResult {
  outResult = "user"
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func %once kernelModeName -> @string outResult {
  outResult = "kernel"
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func %once isrModeName -> @string outResult {
  outResult = "isr"
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#  ADD EXTENSION                                                                                                        
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

override method @modeDeclaration addExtension
  ?!@extensionDeclarationListAST unused ioExtensionDeclarationListAST
  !@abstractDeclaration outNewDeclaration
{
  outNewDeclaration = self
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#  PRECEDENCE GRAPH                                                                                                    *
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

override method @modeDeclaration enterInPrecedenceGraph
  ?!@semanticTypePrecedenceGraph ioGraph
{
  [!?ioGraph addNode !mModeName !self]
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

override getter @modeDeclaration keyRepresentationForErrorSignaling -> @string outRepresentation {
  outRepresentation = "mode " + mModeName 
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#  ENTER IN CONTEXT                                                                                                    *
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

override method @modeDeclaration enterInContext
  ?procedureDeclarationList:let @procedureDeclarationListAST unused inProcedureListAST
  ?!context:@semanticContext ioContext
  ?!staticStringMap:@staticStringMap unused ioGlobalLiteralStringMap
{
  [!?ioContext.mModeMap insertKey !mModeName] ;
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#  SEMANTIC ANALYSIS                                                                                                   *
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

override method @modeDeclaration semanticAnalysis
  ?context:let @semanticContext unused inContext
  ?!temporary:@semanticTemporariesStruct unused ioTemporaries
  ?!intermediateCode:@intermediateCodeStruct unused ioIntermediateCodeStruct
{
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

