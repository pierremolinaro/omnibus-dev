#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
#  PROPERTY MAP                                                                                                                  
#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

enum @propertyAccessKind {
  case constantProperty (@objectIR value)
  case indexed  (@PLMType type @uint index)
  case nonVirtualMethod (@routineDescriptor descriptor)
}

#·······················································································································

map @propertyMap {
  @bool mIsPublic
  @propertyAccessKind mAccess
  insert insertKey error message "the '%K' property is already declared"
  search searchKey error message "there is no '%K' property"
}

#·······················································································································

setter @propertyMap addFunction
  ?receiverTypeName:let @string inReceiverTypeName
  ?methodName:let @string inMethodName
  ?safe:let @bool inIsSafe
  ?resultTypeProxy:let @unifiedTypeMap-proxy inResultType
  ?!@subprogramInvocationGraph ioSubprogramInvocationGraph
{
  let @routineDescriptor descriptor = .new {
    !isPublic:true
    !exported:false
    !routineKind:.function {!executionMode:.anyMode} # @routineKind mRoutineKind
    !signature:{}
    !returnTypeProxy:inResultType # Return type 
    !canAccessProperties:false # Routine is declared with @access attribute
    !canMutateProperties:false # Routine is declared with @mutating attribute
    !safe:inIsSafe # Routine is declared with @safe attribute
  }
  [!?self insertKey
    ![inMethodName + "()" nowhere]
    !true
    !.nonVirtualMethod {!descriptor:descriptor}
  ]
#--- Routine mangled name
  let routineNameForInvocationGraph = routineMangledNameFromAST (
    !llvmTypeStringFromPLMname (!inReceiverTypeName)
    ![inMethodName nowhere]
    !{}
  )
  [!?ioSubprogramInvocationGraph addNode
    !routineNameForInvocationGraph
    !routineNameForInvocationGraph
  ]
}

#———————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
