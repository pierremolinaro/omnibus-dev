target "teensy-3-1-tp"

//------------------------------------------------*

section emptySection () {
}

//------------------------------------------------*

service emptyService () {
}

//------------------------------------------------*

section getSysTick () -> $uint32 {
  result = SYST_CVR
}

//------------------------------------------------*

task T priority 0 stackSize 512 {

  init 1 {
  //--- Compute getSysTick duration
    time.waitDuringMS (!delay:1)
    var t0 = getSysTick ()
    var t1 = getSysTick ()
    let systickDuration = t0 - t1
    lcd.printUnsigned (!systickDuration)
    time.waitDuringMS (!delay:1)
    t0 = getSysTick ()
    t1 = getSysTick ()
    lcd.printSpaces (!1)
    lcd.printUnsigned (!t0 - t1)
    time.waitDuringMS (!delay:1)
    t0 = getSysTick ()
    t1 = getSysTick ()
    lcd.printSpaces (!1)
    lcd.printUnsigned (!t0 - t1)
    time.waitDuringMS (!delay:1)
    t0 = getSysTick ()
    t1 = getSysTick ()
    lcd.printSpaces (!1)
    lcd.printUnsigned (!t0 - t1)
  //--- Compute emptySection duration
    time.waitDuringMS (!delay:1)
    t0 = getSysTick ()
    emptySection ()
    t1 = getSysTick ()
    lcd.goto (!line:1 !column:0)
    lcd.printUnsigned (!(t0 - t1) - systickDuration)
    time.waitDuringMS (!delay:1)
    t0 = getSysTick ()
    emptySection ()
    t1 = getSysTick ()
    lcd.printSpaces (!1)
    lcd.printUnsigned (!(t0 - t1) - systickDuration)
    time.waitDuringMS (!delay:1)
    t0 = getSysTick ()
    emptySection ()
    t1 = getSysTick ()
    lcd.printSpaces (!1)
    lcd.printUnsigned (!(t0 - t1) - systickDuration)
    time.waitDuringMS (!delay:1)
    t0 = getSysTick ()
    emptySection ()
    t1 = getSysTick ()
    lcd.printSpaces (!1)
    lcd.printUnsigned (!(t0 - t1) - systickDuration)
  //--- Compute emptyService duration
    time.waitDuringMS (!delay:1)
    t0 = getSysTick ()
    emptyService ()
    t1 = getSysTick ()
    lcd.goto (!line:2 !column:0)
    lcd.printUnsigned (!(t0 - t1) - systickDuration)
    time.waitDuringMS (!delay:1)
    t0 = getSysTick ()
    emptyService ()
    t1 = getSysTick ()
    lcd.printSpaces (!1)
    lcd.printUnsigned (!(t0 - t1) - systickDuration)
    time.waitDuringMS (!delay:1)
    t0 = getSysTick ()
    emptyService ()
    t1 = getSysTick ()
    lcd.printSpaces (!1)
    lcd.printUnsigned (!(t0 - t1) - systickDuration)
    time.waitDuringMS (!delay:1)
    t0 = getSysTick ()
    emptyService ()
    t1 = getSysTick ()
    lcd.printSpaces (!1)
    lcd.printUnsigned (!(t0 - t1) - systickDuration)
  }
  
  func loop () {
    time.waitDuringMS (!delay:250)
    leds.on (!LED_L1) // Allumer la led
    time.waitDuringMS (!delay:250)
    leds.off (!LED_L1)  // Ã‰teindre la led
  }
}

//------------------------------------------------*
